#!/bin/sh
set -e

BUILD=$1
CACHE=$2

cd $CACHE

if cd libpostal; then
  git pull
else
  git clone https://github.com/openvenues/libpostal --depth 1 --single-branch --branch=master
  cd libpostal
fi
./bootstrap.sh
LDFLAGS="-L$BUILD/vendor/lib" CFLAGS="-I$BUILD/vendor/include" PKG_CONFIG_PATH="$BUILD/vendor/lib/pkgconfig" ./configure --prefix=$BUILD/vendor --datadir=$CACHE/libpostal-data
make
make install

cp --recursive $BUILD/vendor/* /app/vendor
